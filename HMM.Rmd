---
title: "Hidden Markov Models"
author: "liuc"
date: "11/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Hidden Markov Models

> https://a-little-book-of-r-for-bioinformatics.readthedocs.io/en/latest/src/chapter10.html
> https://setosa.io/ev/markov-chains/


A Hidden Markov model is a tool for representing probability distribution over a sequence of observations. It assumes that the observation at time t was generated by some process whose state is hidden from the observer.
通过观察observation的分布，推测hidden state。Transition probabilities and Emission Probabilities分别表示 observation和hidden的事件发生概率。

隐马尔可夫模型（Hidden Markov Model，HMM）是一种统计模型，用于表示由被假定为具有隐藏或不可观测状态的马尔可夫过程生成的观测序列。该模型假设观测结果由一个潜在的过程生成，该过程在有限的一组状态之间转移。每个状态都有一个关联的概率分布，用于生成观测结果。HMM的目标是估计生成观测序列的隐藏状态序列。

比如，在基因组学领域，我们计算基因突变的频率，在测序样本比对后得到的观察突变频率的基础上(可以理解为初始概率)，通过HMM



```{r, include=FALSE}
library(easystats)
library(depmixS4)
# library(HMM)

```


隐马尔可夫在生物信息中的应用主要是用于序列性数据的分析。比如DNA测序后call mutation。

```{r}
data(speed)

head(speed)
```

epmix creates an object of class depmix, a dependent mixture model, otherwise known as hidden Markov model. 
```{r}

# HMM with depmix
# response 指的是，观测序列 ~ 隐状态
# 建立观测序列和隐状态之间的关系，其中 "~" 表示关系符号，"|" 表示条件符号
# 这里使用 list 函数表示两个观测序列和对应的隐状态，需要注意的是，每个观测序列对应一个隐状态序列

# family,分布族指定每个观测序列的分布族，例如二项分布、高斯分布等,这里使用 list 函数表示两个观测序列对应的分布族，需要注意的是，每个观测序列对应一个分布族

# nstates: 隐状态数目, 指定隐状态的数目，这个数目需要根据实际问题和数据来确定
# instart: 初始隐状态概率,指定每个隐状态的初始概率，这里使用 c 函数表示一个包含两个元素的向量，表示两个隐状态的概率,需要注意的是，初始概率和转移概率一起构成了隐状态序列的生成模型

# transition: 隐状态转移概率, 指定隐状态之间的转移概率，这里使用 ~1 表示每个隐状态之间的转移概率相等
# 需要注意的是，转移概率和初始概率一起构成了隐状态序列的生成模型
mod <- depmix(response = rt ~ 1, 
              data = speed, 
              nstates = 2, 
              family = gaussian()) # use gaussian() for normally distributed data

fit.mod <- fit(mod)
fit.mod

```
```{r}

summary(fit.mod, which = "transition")

```


```{r}
# predict the states by estimating the posterior
est.states <- posterior(fit.mod)
head(est.states)
```


